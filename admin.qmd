---
title: "Analyse de Sinchro"
subtitle: "Projet Erasmus+ Climatelabs | 2020 - 2023"
format:
  pdf:
   documentclass: article
   classoption: [onecolumn]
   number-sections: true
   geometry: [left=2cm,top=2.5cm,right=2cm,bottom=2cm]
   papersize: a4paper
   include-in-header: [assets/latex.tex]
   keep-tex: true
#   html:
#     toc: true
#     theme: litera
#     anchor-sections: true
#     smooth-scroll: true
#     link-external-icon: true
#     link-external-newwindow: true
#     self-contained: true
prefer-html: true
execute:
  echo: false
  warning: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("R/Climatelabs_original.R")
source("R/1-Data-sincro.R")
options(knitr.kable.NA = ' ')

```

\thispagestyle{fancy}

**Objectif:**

> Cette document est une anlyse globale de l'outil Sinchro pour le Projet Climatelabs piloté au sein de l'ENSGSI

# Temps estimé selon le Grant Agreement du projet
## Quantité de jours per WP initial

```{r,}
Climatelabs.original %>% 
   select(WP, Role, Unit.cost, Jours.GA) %>% 
   mutate(WP = factor(WP)) %>%
   set_names("WP", "Role", "Coût (Euros/Jour)", "Jours (G.A.)") %>% 
   kbl(booktabs = T, digits = 2, escape = F) %>% 
   kable_styling(latex_options = c("hold_position"), full_width = F, font_size = 10) %>% 
   collapse_rows(columns = 1, latex_hline = "major", valign = "middle") 
   #%>% row_spec( c(4, 8, 12, 16), extra_css = "border-bottom: 1px solid")

```


## Quantité totale de Jours par Rôle dans le projet selon Grant Agreement

```{r}
Climatelabs.original %>% mutate(Role= factor(Role, 
          levels = c("Manager", "EC/Enseignant", "Technicien", "Administratif"))) %>% 
   group_by(Role) %>% summarise(Jours = sum(Jours.GA)) %>% 
   kbl(booktabs = T, digits = 2, escape = F,   padding = 0, ) %>% 
   kable_styling(latex_options = c("striped", "hold_position") , full_width = F, font_size = 10) 
```



# UL Sinchro: Janvier 2020 -  Août 2023

Dans le tableau suivante, on identifie la quantité de jours par participant et par tâche identifié sur Sinchro.


```{r}
Tabla.Sinchro <- Sincro
Tabla.Sinchro[Tabla.Sinchro == 0] <- NA
#Tabla.Sinchro %>% mutate_if(is.double, as.character) -> Tabla.Sinchro


#Tabla.Sinchro$WP %>% levels()
# Tabla.Sinchro$WP <- 
#    factor(Tabla.Sinchro$WP, 
#           levels = c("Preparation",
#                      "Development", 
#                      "Quality Plan",
#                      "Dissemination and Exploitation", 
#                      "Management"))

Tabla.Sinchro %>% arrange(WP) %>%
  kbl(booktabs = T) %>%
  kable_styling(latex_options =  c("HOLD_position", "scale_down")) %>% 
   collapse_rows(columns = 1, valign = "middle") %>% 
   column_spec(10, bold = T, color = "black", border_left = T)
  # column_spec(1, width = c("2cm")) , full_width = F, font_size = 8 
#%>% 

```





## Jours déclares en Sinchro pour le projet ClimateLabs

```{r}
Sincro.UL <- Sincro %>% group_by(WP, Role) %>% summarise(Sincro.UL = sum(Total))

Sincro.UL %>% arrange(WP) %>% 
kbl(booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F, font_size = 10) %>% 
  collapse_rows(columns = 1, valign = "middle") 

```




## Differences entre Jours de GA et Jours declarés sur Sinchro

```{r}
# Joinning 
Summary <-
   Climatelabs.original %>% select(WP, Role, Jours.GA) %>%
   mutate(Role= factor(Role, 
          levels = c("Manager", "EC/Enseignant", "Technicien", "Administratif"),
          labels = c("Man", "EC", "Tech", "Admin"))
   ) %>% 
   left_join(Sincro.UL, by=c("WP", "Role")) %>%
   mutate(Difference = Sincro.UL- Jours.GA )


#Summary$Difference = cell_spec(Summary$Difference, color = ifelse(Summary$Difference > 0, "green", "black"))

Summary %>% 
  kbl(booktabs = T) %>%
  kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F ) %>% 
  column_spec(5, bold = T, color = "black", border_left = T) %>% 
  collapse_rows(columns = 1, valign = "middle")

```


## Differences totale entre Jours du GA et Jours declarés sur Sinchro par Rôle

Le tableau montre les jours additionels que l'UL a travaillé dans le projet comme co-financement avec des ressources propres.

```{r}
Summary %>% group_by(Role) %>% summarise("Jours GA" = sum(Jours.GA),
                                         "Jours UL Sinchro" = sum(Sincro.UL, na.rm = TRUE),
                                         Difference = `Jours UL Sinchro` - `Jours GA` ) %>% 
   kbl(booktabs = T, digits = 2, escape = F, ) %>% 
   kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F, font_size = 10) %>% 
   column_spec(4, bold = T, color = "black", border_left = T)

```



## Graphique des distribution des jours dans le projet

```{r, out.width='90%', fig.width=9, fig.height=12}

Summary %>% 
   pivot_longer(cols = Jours.GA:Sincro.UL,
                names_to = "Type") %>% 
   mutate( Role = factor(Role, 
                    levels = c("Man", "EC", "Tech", "Admin"),
                    labels = c("Manager", "EC/Enseignant", "Technicien", "Administratif")),
      Type = factor(Type, 
                    levels = c( "Sincro.UL", "Jours.GA"),
                    labels = c("Sinchro UL", "Jours Grant Agreement")
                    )
   ) %>% 
   ggplot(aes(x = WP, y = value, fill = Type))+
   geom_bar( stat = "Identity", position="dodge") +
   # scale_fill_manual(values=c(
   #                           "grey",
   #                           "blue")) +
   #scale_y_continuous(limits = c(0, 50))  +
   #coord_flip() +
   facet_grid(Role ~ . ) +
   geom_text(
    aes(label = value),
    colour = "black", size = 3,
    vjust = -1, position = position_dodge(.9)
  ) + 
   labs(x="Working Packages",
        y= "Jours",
        fill = "Jours GA et Sinchro") +
   theme_minimal(base_size = 12, base_family = "Palatino")+
   theme(legend.position = 'top')


```





### Gantt Original de Climatelabs

```{r Gantt, include=false, fig.retina=3, out.width='100%', eval=FALSE}
Gannt <- image_read_pdf('Planning/planning.pdf', density = 200)
#image_scale(, "2000")
Gannt
```




