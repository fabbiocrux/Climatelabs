---
title: "Analyse de Sinchro"
subtitle: "Projet Erasmus+ Climatelabs | 2020 - 2023"
format:
  pdf:
   documentclass: article
   classoption: [onecolumn]
   number-sections: true
   geometry: [left=2cm,top=2.5cm,right=2cm,bottom=2cm]
   papersize: a4paper
   include-in-header: [assets/latex.tex]
#   html:
#     toc: true
#     theme: litera
#     anchor-sections: true
#     smooth-scroll: true
#     link-external-icon: true
#     link-external-newwindow: true
#     self-contained: true
prefer-html: true
execute:
  echo: false
  warning: false
---

```{r}
#| include: false
#| 
library(flexdashboard)
source("R/Climatelabs_original.R")
source("R/1-Data-sincro.R")
options(knitr.kable.NA = ' ')

```

\thispagestyle{fancy}

# Objectif:

> Cette document est une anlyse globale de l'outil Sinchro pour le Projet Climatelabs piloté au sein de l'ENSGSI

## Temps estimé selon le Grant Agreement du projet
### Gantt Original de Climatelabs

```{r Gantt, include=TRUE, fig.retina=3, out.width='100%'}
Gannt <- image_read_pdf('Planning/planning.pdf', density = 200)
#image_scale(, "2000")
Gannt
```

### Quantité de jours per WP initial

```{r,}
Climatelabs.original %>% 
   select(WP, Role, Unit.cost, Jours.GA) %>% 
   set_names("WP", "Role", "Coût de chaque Rôle (Euros/Jour)", "Jours (G.A.)") %>% 
   kbl(booktabs = T, digits = 2, escape = F,   padding = 0, format = "html", table.attr='class="myTable"' ) %>% 
   kable_styling(latex_options = "striped", full_width = T, font_size = 14) %>% 
   row_spec( c(4, 8, 12, 16), extra_css = "border-bottom: 1px solid") %>% 
   collapse_rows(columns = 1, valign = "middle") 
```


# Total of days

```{r}
Climatelabs.original %>% group_by(Role) %>% summarise(Days = sum(Jours.GA)) %>% 
   kbl(booktabs = T, digits = 2, escape = F,   padding = 0, format = "html", table.attr='class="myTable"' ) %>% 
   kable_styling(latex_options = "striped", full_width = T, font_size = 14) 
```

---


# UL Sinchro: Janvier 2020 - `r format(Sys.time(), "%b %d %Y")`

```{r, include=TRUE}
Tabla.Sinchro <- Sincro
Tabla.Sinchro[Tabla.Sinchro == 0] <- NA
#Tabla.Sinchro %>% mutate_if(is.double, as.character) -> Tabla.Sinchro


#Tabla.Sinchro$WP %>% levels()
Tabla.Sinchro$WP <- 
   factor(Tabla.Sinchro$WP, 
          levels = c("Preparation",
                     "Development", 
                     "Quality Plan",
                     "Dissemination\nexploitation", 
                     "Management"))

Tabla.Sinchro %>% arrange(WP) %>% 
  kbl(booktabs = T,  format = "html", table.attr='class="myTable"') %>% 
  kable_styling(latex_options = "striped", full_width = T, font_size = 10 ) %>%
  collapse_rows(columns = 1:2, valign = "middle") 

```


---

# Sinchro UL - ClimateLabs

```{r}
Sincro.UL <- Sincro %>% group_by(WP, Role) %>% summarise(Sincro.UL = sum(Total))
# Joinning 
Summary <- 
   Climatelabs.original %>% left_join(Sincro.UL, by=c("WP", "Role")) %>% 
   select(WP:Unit.cost, Sincro.UL)

Summary$WP <- 
   factor(Summary$WP, 
          levels = c("Preparation",
                     "Development", 
                     "Quality Plan",
                     "Dissemination\nexploitation", 
                     "Management"))


Summary %>% select(-Unit.cost) %>% 
   kbl(booktabs = T) %>% 
  kable_styling(latex_options = "striped", full_width = T, font_size = 17) %>% 
  collapse_rows(columns = 1:2, valign = "middle") 

```



```{r}
Summary %>% group_by(Role) %>% summarise(Days = sum(Jours.GA),
                                         Days_UL = sum(Sincro.UL, na.rm = TRUE),
                                         Days_to_declare = Days - Days_UL) %>% 
   kbl(booktabs = T, digits = 2, escape = F,   padding = 0, format = "html", table.attr='class="myTable"' ) %>% 
   kable_styling(latex_options = "striped", full_width = T, font_size = 17) 
```


---

# Graph

```{r, out.width='90%', fig.width=7, fig.height=8}

Summary %>% select(-Unit.cost) %>% 
   pivot_longer(cols = Jours.GA:Sincro.UL,
                names_to = "Type") %>% 
   mutate( Role = factor(Role, 
                    levels = c("Manager", "EC/Enseignant",
                               "Administratif", "Technicien"),
                    labels = c("Manager", "EC/Enseignant",
                               "Administratif", "Technicien")),
      Type = factor(Type, 
                    levels = c( "Sincro.UL", "Jours.GA"),
                    labels = c("Sinchro UL", "Grant Agreement")
                    )
   ) %>% 
   ggplot(aes(x = WP, y = value, fill = Type))+
   geom_bar( stat = "Identity", position="dodge") +
   scale_fill_manual(values=c(
                             "grey",
                             "black")) +
   #scale_y_continuous(limits = c(0, 50))  +
   #coord_flip() +
   facet_grid(Role ~ . , scales = "free_y") +
   geom_text(
    aes(label = value),
    colour = "white", size = 3,
    vjust = 1, position = position_dodge(.9)
  ) + 
   theme_minimal(base_size = 12, base_family = "Palatino")+
   theme(legend.position = 'right')


```


Sinchro: Janvier 2020 - `r format(Sys.time(), "%b %d %Y")`